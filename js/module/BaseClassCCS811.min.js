const C={WHIV:129,SDRD:8,SFM:128,MMID:8,BLAS:244},MEAS_MODE={IDLE:0,S1:16,S10:32,S60:48,S025:64},REGS={STAT:0,MEMO:1,ARD:2,ENVD:5,BASE:17,WHOI:32,SW_R:255};function getDriveMode(mode){switch(mode){case 0:return MEAS_MODE.IDLE;case 1:return MEAS_MODE.S1;case 2:return MEAS_MODE.S10;case 3:return MEAS_MODE.S60;case 4:return MEAS_MODE.S025;default:throw"Invalid mode!"+mode}}function wrapWithnWake(nWakePin,i2cFunc){return function(arg1,arg2){nWakePin.write(0);var i2cResult=i2cFunc(arg1,arg2);return nWakePin.write(1),i2cResult}}function CCS811(r,w,options){this.r=options&&options.nWake?wrapWithnWake(options.nWake,r):r,this.w=options&&options.nWake?wrapWithnWake(options.nWake,w):w,this.options=options||{},this.options.mode=this.options.mode||1,this.w(REGS.SW_R,[17,229,114,138]);var ccs=this;setTimeout((function(){if(ccs.r(REGS.WHOI,1)[0]!=C.WHIV)throw"CCS811 WHO_AM_I check failed";ccs.w(C.BLAS,[]),setTimeout((function(){if(!ccs.r(REGS.STAT,1)[0]&C.SFM)throw"CCS811 not in FW mode";ccs.setMode(ccs.options.mode)}),100)}),100)}function convertEnvData(humidity,temperature){if(isNaN(humidity))throw"CCS811 RH NaN!";if(isNaN(temperature))throw"CCS811 Temp NaN!";if(!(humidity>=0&&humidity<=100))throw"CCS811 RH invalid!";var humiData=512*humidity,tempData=512*(Math.max(-25,temperature)+25),regData;return[humiData>>8,255&humiData,tempData>>8,255&tempData]}CCS811.prototype._setupWatch=function(){var ccs=this;ccs.options.int&&!ccs.watch&&(ccs.watch=setWatch((function(){ccs.emit("data",ccs.get())}),ccs.options.int,{edge:"falling",repeat:!0}))},CCS811.prototype.stop=function(){this.options.mode=0,this.watch&&(this.watch=clearWatch(this.watch)),this.w(REGS.MEMO,MEAS_MODE.IDLE)},CCS811.prototype.available=function(){return 0!=(this.r(REGS.STAT,1)[0]&C.SDRD)},CCS811.prototype.setMode=function(mode){if(0==mode)this.stop();else{var driveMode=getDriveMode(mode);this.options.mode=mode,this.options.int?(this._setupWatch(),this.w(REGS.MEMO,driveMode|C.MMID)):this.w(REGS.MEMO,driveMode)}},CCS811.prototype.readBaseline=function(){return this.r(REGS.BASE,2)},CCS811.prototype.writeBaseline=function(baseline){this.w(REGS.BASE,baseline)},CCS811.prototype.setEnvData=function(humidity,temperature){var regData=convertEnvData(humidity,temperature);this.w(REGS.ENVD,regData)},CCS811.prototype.get=function(){var d=this.r(REGS.ARD,5),isNew=0!=(d[4]&C.SDRD);return{eCO2:d[0]<<8|d[1],TVOC:d[2]<<8|d[3],new:isNew}},exports.connect=function(i2c,options){var addr=options&&options.addr||90;return new CCS811((function(reg,len){return i2c.writeTo(addr,reg),i2c.readFrom(addr,len)}),(function(reg,data){i2c.writeTo(addr,reg,data)}),options)};